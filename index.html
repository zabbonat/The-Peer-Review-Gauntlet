<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Peer Review Gauntlet üìù‚öîÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-medium: #16213e;
            --bg-light: #0f3460;
            --accent-red: #e94560;
            --accent-gold: #f1c40f;
            --accent-green: #2ecc71;
            --accent-blue: #3498db;
            --accent-purple: #9b59b6;
            --text-primary: #ecf0f1;
            --text-secondary: #bdc3c7;
            --pixel-border: 4px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            image-rendering: pixelated;
        }

        /* Scanline effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            z-index: 1000;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* HEADER */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 4px solid var(--accent-red);
            margin-bottom: 20px;
        }

        .header h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 24px;
            color: var(--accent-gold);
            text-shadow: 4px 4px 0 var(--accent-red);
            margin-bottom: 10px;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .header .subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }

        /* STATS BAR */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-medium);
            border: 4px solid var(--bg-light);
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-bar {
            height: 20px;
            background: var(--bg-dark);
            border: 2px solid var(--text-secondary);
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s ease;
            position: relative;
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent 0%,
                rgba(255,255,255,0.2) 50%,
                transparent 100%
            );
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .stat-value {
            font-size: 14px;
            color: var(--text-primary);
        }

        .novelty .stat-fill { background: var(--accent-purple); }
        .robustness .stat-fill { background: var(--accent-blue); }
        .clarity .stat-fill { background: var(--accent-green); }
        .citations .stat-fill { background: var(--accent-gold); }
        .integrity .stat-fill { background: var(--accent-red); }

        /* GAME ARENA */
        .arena {
            position: relative;
            height: 400px;
            background: 
                linear-gradient(90deg, 
                    var(--bg-dark) 0%, 
                    var(--bg-medium) 20%,
                    var(--bg-light) 50%,
                    var(--bg-medium) 80%,
                    var(--accent-green) 100%
                );
            border: 4px solid var(--accent-gold);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .arena-labels {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            z-index: 10;
        }

        .label-submission {
            color: var(--accent-red);
        }

        .label-acceptance {
            color: var(--accent-green);
        }

        /* PATH */
        .path {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 60px;
            transform: translateY(-50%);
            background: 
                repeating-linear-gradient(
                    90deg,
                    var(--bg-dark) 0px,
                    var(--bg-dark) 20px,
                    var(--bg-medium) 20px,
                    var(--bg-medium) 40px
                );
            border-top: 4px dashed var(--text-secondary);
            border-bottom: 4px dashed var(--text-secondary);
        }

        .path-markers {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 5%;
        }

        .marker {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: center;
            opacity: 0.7;
        }

        /* MANUSCRIPT (Player) */
        .manuscript {
            position: absolute;
            width: 60px;
            height: 80px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 20;
            transition: left 0.5s ease;
            cursor: pointer;
        }

        .manuscript-sprite {
            width: 100%;
            height: 100%;
            background: var(--text-primary);
            border: 4px solid var(--bg-dark);
            position: relative;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.5);
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .manuscript-sprite::before {
            content: 'üìÑ';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
        }

        .manuscript-sprite::after {
            content: '';
            position: absolute;
            top: 5px;
            left: 10px;
            right: 10px;
            height: 3px;
            background: var(--bg-dark);
            box-shadow: 
                0 8px 0 var(--bg-dark),
                0 16px 0 var(--bg-dark),
                0 24px 0 var(--bg-dark);
        }

        .manuscript.damaged {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateY(-50%) translateX(0); }
            25% { transform: translateY(-50%) translateX(-10px); }
            75% { transform: translateY(-50%) translateX(10px); }
        }

        .manuscript.shielded .manuscript-sprite {
            box-shadow: 0 0 20px var(--accent-blue), 4px 4px 0 rgba(0,0,0,0.5);
        }

        /* ENEMIES */
        .enemy {
            position: absolute;
            z-index: 15;
            transition: all 0.3s ease;
        }

        .enemy-sprite {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            animation: enemyBounce 0.5s ease-in-out infinite;
        }

        @keyframes enemyBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .enemy-name {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
            color: var(--accent-red);
            font-family: 'Press Start 2P', cursive;
        }

        .enemy.attacking .enemy-sprite {
            animation: attack 0.3s ease-in-out;
        }

        @keyframes attack {
            0% { transform: translateX(0); }
            50% { transform: translateX(-20px) scale(1.3); }
            100% { transform: translateX(0); }
        }

        .enemy.defeated {
            animation: defeat 0.5s ease-out forwards;
        }

        @keyframes defeat {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }

        /* ATTACK EFFECTS */
        .attack-text {
            position: absolute;
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            color: var(--accent-red);
            white-space: nowrap;
            animation: attackTextAnim 2s ease-out forwards;
            z-index: 100;
            text-shadow: 2px 2px 0 var(--bg-dark);
            pointer-events: none;
        }

        @keyframes attackTextAnim {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* DEFENSES PANEL */
        .defenses-panel {
            background: var(--bg-medium);
            border: 4px solid var(--bg-light);
            padding: 15px;
            margin-bottom: 20px;
        }

        .defenses-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: var(--accent-gold);
            margin-bottom: 15px;
            text-align: center;
        }

        .defenses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .defense-btn {
            background: var(--bg-dark);
            border: 3px solid var(--text-secondary);
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .defense-btn:hover:not(:disabled) {
            border-color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .defense-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .defense-btn:active:not(:disabled) {
            transform: translateY(2px);
        }

        .defense-name {
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            color: var(--accent-gold);
            margin-bottom: 5px;
        }

        .defense-desc {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .defense-cost {
            font-size: 12px;
            color: var(--accent-red);
        }

        .defense-cooldown {
            font-size: 10px;
            color: var(--accent-blue);
        }

        /* MESSAGE LOG */
        .message-log {
            background: var(--bg-dark);
            border: 4px solid var(--bg-light);
            height: 150px;
            overflow-y: auto;
            padding: 10px;
            font-size: 14px;
        }

        .message-log::-webkit-scrollbar {
            width: 10px;
        }

        .message-log::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        .message-log::-webkit-scrollbar-thumb {
            background: var(--bg-light);
            border: 2px solid var(--bg-dark);
        }

        .log-entry {
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 3px solid var(--text-secondary);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-entry.damage { border-color: var(--accent-red); color: var(--accent-red); }
        .log-entry.defense { border-color: var(--accent-blue); color: var(--accent-blue); }
        .log-entry.progress { border-color: var(--accent-green); color: var(--accent-green); }
        .log-entry.spawn { border-color: var(--accent-purple); color: var(--accent-purple); }
        .log-entry.system { border-color: var(--accent-gold); color: var(--accent-gold); }

        /* GAME OVER / WIN SCREEN */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            flex-direction: column;
        }

        .overlay.active {
            display: flex;
        }

        .overlay h2 {
            font-family: 'Press Start 2P', cursive;
            font-size: 32px;
            margin-bottom: 20px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .overlay.win h2 { color: var(--accent-green); }
        .overlay.lose h2 { color: var(--accent-red); }

        .overlay p {
            font-size: 18px;
            margin-bottom: 30px;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }

        .overlay button {
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            padding: 15px 30px;
            background: var(--accent-gold);
            color: var(--bg-dark);
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .overlay button:hover {
            transform: scale(1.1);
        }

        /* START SCREEN */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            text-align: center;
        }

        .start-screen.hidden {
            display: none;
        }

        .start-screen h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 28px;
            color: var(--accent-gold);
            text-shadow: 4px 4px 0 var(--accent-red);
            margin-bottom: 30px;
            animation: titlePulse 2s ease-in-out infinite;
        }

        .start-screen .story {
            max-width: 700px;
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            color: var(--text-secondary);
        }

        .start-screen .story em {
            color: var(--accent-gold);
            font-style: normal;
        }

        .enemy-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin-bottom: 30px;
        }

        .enemy-card {
            background: var(--bg-medium);
            border: 3px solid var(--bg-light);
            padding: 15px;
            text-align: center;
        }

        .enemy-card .emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .enemy-card .name {
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            color: var(--accent-red);
            margin-bottom: 5px;
        }

        .enemy-card .desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .start-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            padding: 20px 40px;
            background: var(--accent-green);
            color: var(--bg-dark);
            border: none;
            cursor: pointer;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 20px 10px rgba(46, 204, 113, 0); }
        }

        .start-btn:hover {
            background: var(--accent-gold);
        }

        /* Progress indicator */
        .progress-indicator {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            color: var(--accent-gold);
        }

        /* Journal selector */
        .journal-indicator {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            color: var(--text-secondary);
            background: var(--bg-dark);
            padding: 5px 15px;
            border: 2px solid var(--text-secondary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 16px;
            }
            
            .arena {
                height: 300px;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }

            .start-screen h1 {
                font-size: 18px;
            }

            .enemy-preview {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Achievement popup */
        .achievement {
            position: fixed;
            top: 20px;
            right: -300px;
            background: var(--bg-medium);
            border: 4px solid var(--accent-gold);
            padding: 15px 20px;
            z-index: 500;
            transition: right 0.5s ease;
        }

        .achievement.show {
            right: 20px;
        }

        .achievement-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            color: var(--accent-gold);
            margin-bottom: 5px;
        }

        .achievement-name {
            font-size: 16px;
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <!-- START SCREEN -->
    <div class="start-screen" id="startScreen">
        <h1>üìù THE PEER REVIEW GAUNTLET ‚öîÔ∏è</h1>
        
        <div class="story">
            You are a young researcher. You spent <em>18 months</em> writing the perfect paper.<br>
            The data is solid. The methodology is robust. The conclusions are... <em>modest but relevant</em>.<br><br>
            Now your Manuscript must traverse the dreaded <em>Gauntlet</em> ‚Äî a perilous path from Submission to Acceptance, 
            through territories infested by hostile academic creatures.<br><br>
            <em>Survive the reviewers. Reach acceptance. Publish or perish.</em>
        </div>

        <div class="enemy-preview">
            <div class="enemy-card">
                <div class="emoji">üö™</div>
                <div class="name">DESK REJECTION</div>
                <div class="desc">"Out of scope"</div>
            </div>
            <div class="enemy-card">
                <div class="emoji">üòá</div>
                <div class="name">REVIEWER 1</div>
                <div class="desc">"Minor revisions"</div>
            </div>
            <div class="enemy-card">
                <div class="emoji">üíÄ</div>
                <div class="name">REVIEWER 2</div>
                <div class="desc">"Major revisions needed"</div>
            </div>
            <div class="enemy-card">
                <div class="emoji">üëª</div>
                <div class="name">REVIEWER 3</div>
                <div class="desc">"..." (Never responds)</div>
            </div>
            <div class="enemy-card">
                <div class="emoji">ü™û</div>
                <div class="name">SELF-CITER</div>
                <div class="desc">"Cite my 47 papers"</div>
            </div>
            <div class="enemy-card">
                <div class="emoji">‚öñÔ∏è</div>
                <div class="name">EDITOR</div>
                <div class="desc">"After consideration..."</div>
            </div>
        </div>

        <button class="start-btn" onclick="startGame()">‚ñ∂ START SUBMISSION</button>
    </div>

    <!-- GAME CONTAINER -->
    <div class="game-container">
        <header class="header">
            <h1>üìù THE PEER REVIEW GAUNTLET ‚öîÔ∏è</h1>
            <p class="subtitle">SURVIVE THE REVIEWERS ‚Ä¢ REACH ACCEPTANCE</p>
        </header>

        <!-- STATS BAR -->
        <div class="stats-bar">
            <div class="stat novelty">
                <div class="stat-label">Novelty</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="noveltyBar" style="width: 70%"></div>
                </div>
                <div class="stat-value" id="noveltyValue">70/100</div>
            </div>
            <div class="stat robustness">
                <div class="stat-label">Robustness</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="robustnessBar" style="width: 80%"></div>
                </div>
                <div class="stat-value" id="robustnessValue">80/100</div>
            </div>
            <div class="stat clarity">
                <div class="stat-label">Clarity</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="clarityBar" style="width: 75%"></div>
                </div>
                <div class="stat-value" id="clarityValue">75/100</div>
            </div>
            <div class="stat citations">
                <div class="stat-label">Citations</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="citationsBar" style="width: 60%"></div>
                </div>
                <div class="stat-value" id="citationsValue">60/100</div>
            </div>
            <div class="stat integrity">
                <div class="stat-label">Paper HP</div>
                <div class="stat-bar">
                    <div class="stat-fill" id="integrityBar" style="width: 100%"></div>
                </div>
                <div class="stat-value" id="integrityValue">100/100</div>
            </div>
        </div>

        <!-- GAME ARENA -->
        <div class="arena" id="arena">
            <div class="arena-labels">
                <span class="label-submission">üì§ SUBMISSION</span>
                <span class="label-acceptance">‚úÖ ACCEPTANCE</span>
            </div>
            
            <div class="journal-indicator" id="journalIndicator">
                üéØ TARGET: Field Journal (Impact Factor: 3.2)
            </div>

            <div class="path">
                <div class="path-markers">
                    <div class="marker">Initial<br>Check</div>
                    <div class="marker">Editor<br>Review</div>
                    <div class="marker">Peer<br>Review</div>
                    <div class="marker">Revision<br>Round</div>
                    <div class="marker">Final<br>Decision</div>
                </div>
            </div>

            <div class="manuscript" id="manuscript">
                <div class="manuscript-sprite"></div>
            </div>

            <div class="progress-indicator" id="progressIndicator">Progress: 0%</div>
        </div>

        <!-- DEFENSES PANEL -->
        <div class="defenses-panel">
            <div class="defenses-title">‚öîÔ∏è DEFENSES & POWER-UPS ‚öîÔ∏è</div>
            <div class="defenses-grid">
                <button class="defense-btn" id="defenseResponse" onclick="useDefense('response')">
                    <div class="defense-name">üìß Response Letter</div>
                    <div class="defense-desc">Reflect damage back to reviewer</div>
                    <div class="defense-cost">Cost: 10 Clarity</div>
                    <div class="defense-cooldown" id="responseCooldown">Ready</div>
                </button>
                <button class="defense-btn" id="defenseSupplementary" onclick="useDefense('supplementary')">
                    <div class="defense-name">üìä Supplementary Materials</div>
                    <div class="defense-desc">+20 Robustness for 30 seconds</div>
                    <div class="defense-cost">Cost: 15 Citations</div>
                    <div class="defense-cooldown" id="supplementaryCooldown">Ready</div>
                </button>
                <button class="defense-btn" id="defenseCoauthor" onclick="useDefense('coauthor')">
                    <div class="defense-name">üõ°Ô∏è Senior Coauthor Shield</div>
                    <div class="defense-desc">Block next attack completely</div>
                    <div class="defense-cost">Cost: 20 Novelty (authorship...)</div>
                    <div class="defense-cooldown" id="coauthorCooldown">Ready</div>
                </button>
                <button class="defense-btn" id="defenseCoffee" onclick="useDefense('coffee')">
                    <div class="defense-name">‚òï Emergency Coffee</div>
                    <div class="defense-desc">Speed boost! +15% progress</div>
                    <div class="defense-cost">Cost: 10 HP</div>
                    <div class="defense-cooldown" id="coffeeCooldown">Ready</div>
                </button>
            </div>
        </div>

        <!-- MESSAGE LOG -->
        <div class="message-log" id="messageLog">
            <div class="log-entry system">‚ö° Welcome to The Peer Review Gauntlet!</div>
            <div class="log-entry system">üìù Your manuscript begins its journey...</div>
        </div>
    </div>

    <!-- WIN OVERLAY -->
    <div class="overlay win" id="winOverlay">
        <h2>üéâ ACCEPTED! üéâ</h2>
        <p id="winMessage">Your paper has been accepted for publication! 
        After countless revisions, sleepless nights, and one too many "minor" comments from Reviewer 2, 
        your contribution to human knowledge is finally recognized.</p>
        <p><strong>Achievement Unlocked:</strong> <span id="winAchievement">"The Long Game"</span></p>
        <button onclick="restartGame()">‚ñ∂ SUBMIT ANOTHER PAPER</button>
    </div>

    <!-- LOSE OVERLAY -->
    <div class="overlay lose" id="loseOverlay">
        <h2>üíÄ REJECTED üíÄ</h2>
        <p id="loseMessage">Your paper has been rejected. The reviewers were merciless, 
        but remember: even the best scientists face rejection. 
        Revise, resubmit, and try again!</p>
        <p><strong>Achievement Unlocked:</strong> <span id="loseAchievement">"First Blood"</span></p>
        <button onclick="restartGame()">‚ñ∂ RESUBMIT</button>
    </div>

    <!-- ACHIEVEMENT POPUP -->
    <div class="achievement" id="achievementPopup">
        <div class="achievement-title">üèÜ ACHIEVEMENT UNLOCKED</div>
        <div class="achievement-name" id="achievementName"></div>
    </div>

    <script>
        // ============== GAME STATE ==============
        const gameState = {
            running: false,
            progress: 0,
            stats: {
                novelty: 70,
                robustness: 80,
                clarity: 75,
                citations: 60,
                integrity: 100
            },
            enemies: [],
            cooldowns: {
                response: 0,
                supplementary: 0,
                coauthor: 0,
                coffee: 0
            },
            buffs: {
                robustnessBoost: false,
                shield: false
            },
            achievements: [],
            attacksReceived: 0,
            defensesUsed: 0,
            reviewer2Encounters: 0
        };

        // ============== ENEMY DEFINITIONS ==============
        const enemyTypes = {
            deskRejection: {
                name: "Desk Rejection",
                emoji: "üö™",
                attacks: [
                    { text: '"Out of scope!"', damage: 25, stat: 'integrity' },
                    { text: '"Not suitable for this journal"', damage: 20, stat: 'integrity' }
                ],
                spawnChance: 0.15,
                minProgress: 0,
                maxProgress: 20
            },
            reviewer1: {
                name: "Reviewer 1",
                emoji: "üòá",
                attacks: [
                    { text: '"Minor typo on page 3"', damage: 5, stat: 'integrity' },
                    { text: '"Nice work! Small suggestions..."', damage: 3, stat: 'integrity' },
                    { text: '"Consider rephrasing line 42"', damage: 5, stat: 'clarity', statDamage: 5 }
                ],
                spawnChance: 0.2,
                minProgress: 20,
                maxProgress: 100
            },
            reviewer2: {
                name: "REVIEWER 2",
                emoji: "üíÄ",
                attacks: [
                    { text: '"MAJOR REVISIONS NEEDED"', damage: 20, stat: 'integrity' },
                    { text: '"This is not novel"', damage: 15, stat: 'novelty', statDamage: 15 },
                    { text: '"Why didn\'t you use [different method]?"', damage: 15, stat: 'robustness', statDamage: 10 },
                    { text: '"The writing is unclear"', damage: 10, stat: 'clarity', statDamage: 10 },
                    { text: '"Missing key references"', damage: 10, stat: 'citations', statDamage: 15 },
                    { text: '"Reject and resubmit elsewhere"', damage: 30, stat: 'integrity' },
                    { text: '"I have concerns..."', damage: 15, stat: 'integrity' }
                ],
                spawnChance: 0.25,
                minProgress: 30,
                maxProgress: 100
            },
            reviewer3: {
                name: "Reviewer 3",
                emoji: "üëª",
                attacks: [
                    { text: '"..."', damage: 0, stat: 'integrity', special: 'delay' }
                ],
                spawnChance: 0.1,
                minProgress: 30,
                maxProgress: 80
            },
            selfCiter: {
                name: "Self-Citer",
                emoji: "ü™û",
                attacks: [
                    { text: '"Please cite: Me (2008), Me (2011), Me (2015)..."', damage: 10, stat: 'citations', statDamage: 20 },
                    { text: '"The authors ignore seminal work by [me]"', damage: 15, stat: 'citations', statDamage: 15 }
                ],
                spawnChance: 0.15,
                minProgress: 40,
                maxProgress: 90
            },
            scopeCreeper: {
                name: "Scope Creeper",
                emoji: "üêô",
                attacks: [
                    { text: '"Have you considered also analyzing [entirely different topic]?"', damage: 10, stat: 'integrity' },
                    { text: '"This needs 4 more experiments"', damage: 15, stat: 'robustness', statDamage: 10 }
                ],
                spawnChance: 0.15,
                minProgress: 50,
                maxProgress: 90
            },
            editor: {
                name: "Editor-in-Chief",
                emoji: "‚öñÔ∏è",
                attacks: [
                    { text: '"After careful consideration..."', damage: 15, stat: 'integrity' },
                    { text: '"Despite positive reviews, we must decline"', damage: 25, stat: 'integrity' },
                    { text: '"Please address ALL reviewer comments"', damage: 10, stat: 'integrity' }
                ],
                spawnChance: 0.1,
                minProgress: 70,
                maxProgress: 100
            }
        };

        // ============== ACHIEVEMENT DEFINITIONS ==============
        const achievements = {
            firstBlood: { name: '"First Blood"', desc: 'Receive your first rejection' },
            perseverance: { name: '"Perseverance"', desc: 'Survive 10 attacks' },
            stockholm: { name: '"Stockholm Syndrome"', desc: 'Thank Reviewer 2 (use Response Letter against them)' },
            survivor: { name: '"The Survivor"', desc: 'Win with less than 20 HP' },
            flawless: { name: '"Flawless Victory"', desc: 'Win with more than 80 HP' },
            caffeinated: { name: '"Caffeinated"', desc: 'Use coffee 3 times' },
            ghosted: { name: '"Ghosted"', desc: 'Encounter Reviewer 3' }
        };

        let coffeeUses = 0;
        let gameLoopInterval;
        let enemySpawnInterval;

        // ============== DOM ELEMENTS ==============
        const arena = document.getElementById('arena');
        const manuscript = document.getElementById('manuscript');
        const messageLog = document.getElementById('messageLog');
        const progressIndicator = document.getElementById('progressIndicator');

        // ============== GAME FUNCTIONS ==============
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            gameState.running = true;
            
            // Start game loops
            gameLoopInterval = setInterval(gameLoop, 100);
            enemySpawnInterval = setInterval(spawnEnemy, 3000);
            
            addLog('üì§ Manuscript submitted! The gauntlet begins...', 'system');
            
            // Initial enemy after 2 seconds
            setTimeout(() => {
                if (gameState.running) spawnEnemy();
            }, 2000);
        }

        function gameLoop() {
            if (!gameState.running) return;

            // Progress the manuscript
            gameState.progress += 0.15;
            
            // Update UI
            updateManuscriptPosition();
            updateProgressIndicator();
            updateCooldowns();

            // Check win condition
            if (gameState.progress >= 100) {
                winGame();
            }

            // Process enemy attacks
            processEnemies();
        }

        function updateManuscriptPosition() {
            const maxLeft = arena.offsetWidth - manuscript.offsetWidth - 20;
            const leftPos = 10 + (gameState.progress / 100) * maxLeft;
            manuscript.style.left = leftPos + 'px';
        }

        function updateProgressIndicator() {
            progressIndicator.textContent = `Progress: ${Math.floor(gameState.progress)}%`;
        }

        function updateCooldowns() {
            const now = Date.now();
            
            for (const [key, value] of Object.entries(gameState.cooldowns)) {
                const element = document.getElementById(key + 'Cooldown');
                const btn = document.getElementById('defense' + key.charAt(0).toUpperCase() + key.slice(1));
                
                if (value > now) {
                    const remaining = Math.ceil((value - now) / 1000);
                    element.textContent = `Cooldown: ${remaining}s`;
                    btn.disabled = true;
                } else {
                    element.textContent = 'Ready';
                    btn.disabled = false;
                }
            }
        }

        function spawnEnemy() {
            if (!gameState.running) return;
            if (gameState.enemies.length >= 3) return; // Max 3 enemies at once

            // Filter eligible enemies based on progress
            const eligibleTypes = Object.entries(enemyTypes).filter(([key, enemy]) => {
                return gameState.progress >= enemy.minProgress && 
                       gameState.progress <= enemy.maxProgress &&
                       Math.random() < enemy.spawnChance;
            });

            if (eligibleTypes.length === 0) return;

            // Pick random enemy type
            const [typeKey, type] = eligibleTypes[Math.floor(Math.random() * eligibleTypes.length)];
            
            // Create enemy
            const enemy = {
                id: Date.now() + Math.random(),
                type: typeKey,
                ...type,
                x: Math.random() * 60 + 20, // Random position (20-80%)
                y: Math.random() > 0.5 ? 15 : 75, // Top or bottom of path
                attackCooldown: 2000 + Math.random() * 2000,
                lastAttack: Date.now()
            };

            gameState.enemies.push(enemy);
            renderEnemy(enemy);
            
            addLog(`‚ö†Ô∏è ${enemy.emoji} ${enemy.name} appeared!`, 'spawn');
            
            // Achievement for Reviewer 3
            if (typeKey === 'reviewer3') {
                unlockAchievement('ghosted');
            }
            
            // Track Reviewer 2
            if (typeKey === 'reviewer2') {
                gameState.reviewer2Encounters++;
            }
        }

        function renderEnemy(enemy) {
            const enemyEl = document.createElement('div');
            enemyEl.className = 'enemy';
            enemyEl.id = 'enemy-' + enemy.id;
            enemyEl.style.left = enemy.x + '%';
            enemyEl.style.top = enemy.y + '%';
            enemyEl.innerHTML = `
                <div class="enemy-sprite">${enemy.emoji}</div>
                <div class="enemy-name">${enemy.name}</div>
            `;
            arena.appendChild(enemyEl);
        }

        function processEnemies() {
            const now = Date.now();
            
            gameState.enemies.forEach((enemy, index) => {
                if (now - enemy.lastAttack >= enemy.attackCooldown) {
                    performEnemyAttack(enemy);
                    enemy.lastAttack = now;
                    enemy.attackCooldown = 3000 + Math.random() * 2000;
                }
            });
        }

        function performEnemyAttack(enemy) {
            const attack = enemy.attacks[Math.floor(Math.random() * enemy.attacks.length)];
            
            // Show attack animation
            const enemyEl = document.getElementById('enemy-' + enemy.id);
            if (enemyEl) {
                enemyEl.classList.add('attacking');
                setTimeout(() => enemyEl.classList.remove('attacking'), 300);
            }

            // Check for shield
            if (gameState.buffs.shield) {
                gameState.buffs.shield = false;
                addLog(`üõ°Ô∏è Senior Coauthor blocked: ${attack.text}`, 'defense');
                showAttackText(enemy, 'BLOCKED!', 'var(--accent-blue)');
                manuscript.classList.remove('shielded');
                
                // Remove enemy after blocked attack
                removeEnemy(enemy);
                return;
            }

            // Special: Reviewer 3 delays but doesn't damage
            if (attack.special === 'delay') {
                addLog(`üëª Reviewer 3: ${attack.text} (No response for 2 weeks...)`, 'damage');
                showAttackText(enemy, '... (waiting)', 'var(--text-secondary)');
                return;
            }

            // Apply damage
            gameState.stats.integrity -= attack.damage;
            
            // Apply stat damage if any
            if (attack.statDamage && attack.stat !== 'integrity') {
                gameState.stats[attack.stat] = Math.max(0, gameState.stats[attack.stat] - attack.statDamage);
                updateStatBar(attack.stat);
            }

            updateStatBar('integrity');
            
            // Show damage
            addLog(`üí• ${enemy.emoji} ${enemy.name}: ${attack.text} (-${attack.damage} HP)`, 'damage');
            showAttackText(enemy, attack.text, 'var(--accent-red)');
            
            // Manuscript damage animation
            manuscript.classList.add('damaged');
            setTimeout(() => manuscript.classList.remove('damaged'), 500);

            gameState.attacksReceived++;
            
            // Check for perseverance achievement
            if (gameState.attacksReceived >= 10) {
                unlockAchievement('perseverance');
            }

            // Check lose condition
            if (gameState.stats.integrity <= 0) {
                loseGame();
            }

            // Chance to remove enemy after attack
            if (Math.random() < 0.3) {
                setTimeout(() => removeEnemy(enemy), 1000);
            }
        }

        function showAttackText(enemy, text, color) {
            const attackText = document.createElement('div');
            attackText.className = 'attack-text';
            attackText.textContent = text;
            attackText.style.color = color;
            attackText.style.left = enemy.x + '%';
            attackText.style.top = (enemy.y - 10) + '%';
            arena.appendChild(attackText);
            
            setTimeout(() => attackText.remove(), 2000);
        }

        function removeEnemy(enemy) {
            const index = gameState.enemies.findIndex(e => e.id === enemy.id);
            if (index > -1) {
                gameState.enemies.splice(index, 1);
            }
            
            const enemyEl = document.getElementById('enemy-' + enemy.id);
            if (enemyEl) {
                enemyEl.classList.add('defeated');
                setTimeout(() => enemyEl.remove(), 500);
            }
        }

        function updateStatBar(stat) {
            const bar = document.getElementById(stat + 'Bar');
            const value = document.getElementById(stat + 'Value');
            
            // Apply robustness boost if active
            let displayValue = gameState.stats[stat];
            if (stat === 'robustness' && gameState.buffs.robustnessBoost) {
                displayValue = Math.min(100, displayValue + 20);
            }
            
            bar.style.width = Math.max(0, displayValue) + '%';
            value.textContent = Math.max(0, Math.floor(displayValue)) + '/100';
        }

        // ============== DEFENSE FUNCTIONS ==============
        function useDefense(type) {
            if (!gameState.running) return;
            if (gameState.cooldowns[type] > Date.now()) return;

            switch(type) {
                case 'response':
                    if (gameState.stats.clarity < 10) {
                        addLog('‚ùå Not enough Clarity for Response Letter!', 'system');
                        return;
                    }
                    gameState.stats.clarity -= 10;
                    updateStatBar('clarity');
                    
                    // Damage a random enemy
                    if (gameState.enemies.length > 0) {
                        const target = gameState.enemies[Math.floor(Math.random() * gameState.enemies.length)];
                        addLog(`üìß Response Letter sent to ${target.name}!`, 'defense');
                        
                        // Stockholm achievement if targeting Reviewer 2
                        if (target.type === 'reviewer2') {
                            unlockAchievement('stockholm');
                        }
                        
                        removeEnemy(target);
                    } else {
                        addLog('üìß Response Letter ready... but no reviewers present!', 'defense');
                    }
                    
                    gameState.cooldowns.response = Date.now() + 15000;
                    break;

                case 'supplementary':
                    if (gameState.stats.citations < 15) {
                        addLog('‚ùå Not enough Citations for Supplementary Materials!', 'system');
                        return;
                    }
                    gameState.stats.citations -= 15;
                    updateStatBar('citations');
                    
                    gameState.buffs.robustnessBoost = true;
                    updateStatBar('robustness');
                    addLog('üìä Supplementary Materials uploaded! +20 Robustness for 30s', 'defense');
                    
                    setTimeout(() => {
                        gameState.buffs.robustnessBoost = false;
                        updateStatBar('robustness');
                        addLog('üìä Supplementary Materials effect ended', 'system');
                    }, 30000);
                    
                    gameState.cooldowns.supplementary = Date.now() + 45000;
                    break;

                case 'coauthor':
                    if (gameState.stats.novelty < 20) {
                        addLog('‚ùå Not enough Novelty for Senior Coauthor!', 'system');
                        return;
                    }
                    gameState.stats.novelty -= 20;
                    updateStatBar('novelty');
                    
                    gameState.buffs.shield = true;
                    manuscript.classList.add('shielded');
                    addLog('üõ°Ô∏è Senior Coauthor activated! Next attack blocked.', 'defense');
                    
                    gameState.cooldowns.coauthor = Date.now() + 30000;
                    break;

                case 'coffee':
                    if (gameState.stats.integrity < 10) {
                        addLog('‚ùå Not enough HP for coffee! (Ironic, right?)', 'system');
                        return;
                    }
                    gameState.stats.integrity -= 10;
                    updateStatBar('integrity');
                    
                    gameState.progress = Math.min(99, gameState.progress + 15);
                    addLog('‚òï COFFEE BOOST! +15% progress!', 'defense');
                    
                    coffeeUses++;
                    if (coffeeUses >= 3) {
                        unlockAchievement('caffeinated');
                    }
                    
                    gameState.cooldowns.coffee = Date.now() + 20000;
                    break;
            }

            gameState.defensesUsed++;
        }

        // ============== ACHIEVEMENT FUNCTIONS ==============
        function unlockAchievement(key) {
            if (gameState.achievements.includes(key)) return;
            
            gameState.achievements.push(key);
            const achievement = achievements[key];
            
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementName').textContent = achievement.name;
            popup.classList.add('show');
            
            setTimeout(() => popup.classList.remove('show'), 3000);
            
            addLog(`üèÜ Achievement Unlocked: ${achievement.name}`, 'system');
        }

        // ============== END GAME FUNCTIONS ==============
        function winGame() {
            gameState.running = false;
            clearInterval(gameLoopInterval);
            clearInterval(enemySpawnInterval);
            
            // Check achievements
            if (gameState.stats.integrity < 20) {
                unlockAchievement('survivor');
            }
            if (gameState.stats.integrity > 80) {
                unlockAchievement('flawless');
            }
            
            // Random win messages
            const winMessages = [
                'Your paper has been accepted for publication! After countless revisions, sleepless nights, and one too many "minor" comments from Reviewer 2, your contribution to human knowledge is finally recognized.',
                'ACCEPTED! The editor writes: "We are pleased to inform you..." You read it 17 times to make sure it\'s real.',
                'Against all odds, your manuscript survived the gauntlet. Reviewer 2 is reportedly "disappointed but accepting the editor\'s decision."',
                'Publication confirmed! Your h-index increases by 0.0001. Worth it.'
            ];
            
            document.getElementById('winMessage').textContent = winMessages[Math.floor(Math.random() * winMessages.length)];
            document.getElementById('winAchievement').textContent = gameState.stats.integrity > 80 ? '"Flawless Victory"' : '"The Long Game"';
            document.getElementById('winOverlay').classList.add('active');
            
            addLog('üéâ PAPER ACCEPTED! Congratulations!', 'progress');
        }

        function loseGame() {
            gameState.running = false;
            clearInterval(gameLoopInterval);
            clearInterval(enemySpawnInterval);
            
            unlockAchievement('firstBlood');
            
            // Random lose messages
            const loseMessages = [
                'Your paper has been rejected. The reviewers were merciless, but remember: even the best scientists face rejection. Revise, resubmit, and try again!',
                'REJECTED. Reviewer 2 writes: "While the authors attempt to make a contribution..." You know the rest.',
                'The editor regrets to inform you... Actually, they don\'t seem very regretful.',
                'Your manuscript didn\'t make it. But hey, Einstein was rejected too! (Probably not by Reviewer 2 though.)'
            ];
            
            document.getElementById('loseMessage').textContent = loseMessages[Math.floor(Math.random() * loseMessages.length)];
            document.getElementById('loseAchievement').textContent = '"First Blood"';
            document.getElementById('loseOverlay').classList.add('active');
            
            addLog('üíÄ PAPER REJECTED. Try again!', 'damage');
        }

        function restartGame() {
            // Reset game state
            gameState.running = false;
            gameState.progress = 0;
            gameState.stats = {
                novelty: 70,
                robustness: 80,
                clarity: 75,
                citations: 60,
                integrity: 100
            };
            gameState.enemies = [];
            gameState.cooldowns = {
                response: 0,
                supplementary: 0,
                coauthor: 0,
                coffee: 0
            };
            gameState.buffs = {
                robustnessBoost: false,
                shield: false
            };
            gameState.attacksReceived = 0;
            gameState.defensesUsed = 0;
            coffeeUses = 0;

            // Clear enemies from DOM
            document.querySelectorAll('.enemy').forEach(el => el.remove());
            document.querySelectorAll('.attack-text').forEach(el => el.remove());

            // Reset UI
            ['novelty', 'robustness', 'clarity', 'citations', 'integrity'].forEach(stat => {
                updateStatBar(stat);
            });
            
            manuscript.style.left = '10px';
            manuscript.classList.remove('shielded', 'damaged');
            progressIndicator.textContent = 'Progress: 0%';

            // Clear overlays
            document.getElementById('winOverlay').classList.remove('active');
            document.getElementById('loseOverlay').classList.remove('active');

            // Clear and reset log
            messageLog.innerHTML = `
                <div class="log-entry system">‚ö° New submission started!</div>
                <div class="log-entry system">üìù Your manuscript begins its journey...</div>
            `;

            // Start game
            gameState.running = true;
            gameLoopInterval = setInterval(gameLoop, 100);
            enemySpawnInterval = setInterval(spawnEnemy, 3000);
            
            setTimeout(() => {
                if (gameState.running) spawnEnemy();
            }, 2000);
        }

        // ============== UTILITY FUNCTIONS ==============
        function addLog(message, type = 'system') {
            const entry = document.createElement('div');
            entry.className = 'log-entry ' + type;
            entry.textContent = message;
            messageLog.appendChild(entry);
            messageLog.scrollTop = messageLog.scrollHeight;
        }

        // ============== KEYBOARD SHORTCUTS ==============
        document.addEventListener('keydown', (e) => {
            if (!gameState.running) return;
            
            switch(e.key) {
                case '1': useDefense('response'); break;
                case '2': useDefense('supplementary'); break;
                case '3': useDefense('coauthor'); break;
                case '4': useDefense('coffee'); break;
            }
        });

        // Initialize stat bars
        ['novelty', 'robustness', 'clarity', 'citations', 'integrity'].forEach(stat => {
            updateStatBar(stat);
        });
    </script>
</body>
</html>
